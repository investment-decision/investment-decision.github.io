<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Regime Dashboard</title>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. Basic Settings --- */
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #65676b;
            --accent-growth: #007aff;
            --accent-inflation: #ff3b30;
            --accent-liquidity: #af52de;
            --accent-sentiment: #ff9500;
            --accent-leading: #34c759;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-primary);
        }

        h1, h2, h3 { margin: 0; }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 40px; /* Increased from 20px */
            padding: 0 10px;
        }
        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* --- AdSense Style --- */
        .ad-banner {
            width: 100%;
            height: 100px;
            background-color: #e4e6eb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #65676b;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 8px;
            margin-bottom: 50px; /* Increased from 30px */
            border: 2px dashed #ccc;
            text-align: center;
        }

        /* --- 2. Grid Layout (4 Columns) --- */
        .dashboard-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px; /* Increased from 20px */
            margin-bottom: 50px; /* Increased from 30px */
        }

        .section-title {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 20px; /* Increased from 10px */
            padding-left: 10px;
            font-weight: 600;
            border-left: 4px solid #333;
            line-height: 1.2;
        }

        /* --- 3. Card Style --- */
        .chart-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            display: flex;
            flex-direction: column;
            /* FIX: Use height: 100% to match grid row height, removed min-height to avoid lock-in */
            height: 100%; 
            min-width: 0; /* Crucial for Grid/Flex child shrinking */
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .chart-subtitle {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Info Button (?) */
        .info-btn {
            background: #f0f2f5;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-secondary);
            font-weight: bold;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .info-btn:hover {
            background: #e4e6eb;
            color: var(--text-primary);
        }

        .chart-area {
            position: relative;
            /* FIX: Fixed height prevents Chart.js resize loops/stuck height */
            height: 250px; 
            width: 100%;
            overflow: hidden;
        }

        /* No Data Placeholder */
        .no-data {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #ccc;
            font-size: 0.9rem;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }

        /* --- 4. Popup Modal --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .modal-body {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #444;
        }
        .modal-body ul { padding-left: 20px; margin: 10px 0; }
        .modal-body li { margin-bottom: 5px; }

        /* --- Responsive --- */
        @media (max-width: 1200px) {
            .dashboard-row { 
                grid-template-columns: repeat(2, 1fr); 
            }
        }
        @media (max-width: 768px) {
            .dashboard-row { 
                grid-template-columns: 1fr;
                /* Force vertical gap on mobile */
                gap: 20px;
                row-gap: 20px; 
            }
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>Market Regime Dashboard</h1>
        </div>

        <!-- AdSense Position 1 -->
        <div class="ad-banner">
            Google AdSense Placeholder (Top)
            <br><span style="font-weight:400; font-size:0.8em;">Responsive Display Ad Recommended</span>
        </div>

        <!-- ROW 1: Main Indices -->
        <div class="section-title">Row 1: Main Market Indices</div>
        <div class="dashboard-row">
            
            <!-- 1-1. Macro Regime -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Macro Regime Composite</div>
                        <div class="chart-subtitle">Growth vs Inflation (Quadrant)</div>
                    </div>
                    <button class="info-btn" onclick="openModal('macro')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartMacro"></canvas>
                </div>
            </div>

            <!-- 1-2. Global Net Liquidity -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Global Net Liquidity Gauge</div>
                        <div class="chart-subtitle">Fed Assets - TGA - RRP</div>
                    </div>
                    <button class="info-btn" onclick="openModal('liquidity')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartLiquidity"></canvas>
                </div>
            </div>

            <!-- 1-3. Composite Sentiment -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Composite Sentiment Oscillator</div>
                        <div class="chart-subtitle">Fear vs Greed (0-100)</div>
                    </div>
                    <button class="info-btn" onclick="openModal('sentiment')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartSentiment"></canvas>
                </div>
            </div>

            <!-- 1-4. Inter-Market Leading -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Inter-Market Leading Indicator</div>
                        <div class="chart-subtitle">Smart Money Composite</div>
                    </div>
                    <button class="info-btn" onclick="openModal('leading')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartLeading"></canvas>
                </div>
            </div>
        </div>

        <!-- AdSense Position 2 -->
        <div class="ad-banner">
            Google AdSense Placeholder (Middle)
            <br><span style="font-weight:400; font-size:0.8em;">Responsive In-article or Display Ad</span>
        </div>

        <!-- ROW 2: Macro Components (Z-Scores) -->
        <div class="section-title">Row 2: Macro Drivers (Time Series)</div>
        <div class="dashboard-row">
            
            <!-- 2-1. Z_PMI -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Z_PMI (Manufacturing)</div>
                        <div class="chart-subtitle">Growth Driver</div>
                    </div>
                    <button class="info-btn" onclick="openModal('pmi')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartPmi"></canvas>
                </div>
            </div>

            <!-- 2-2. Z_Ratio -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Z_Ratio (Cyc/Def)</div>
                        <div class="chart-subtitle">Market Sentiment Driver</div>
                    </div>
                    <button class="info-btn" onclick="openModal('ratio')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartRatio"></canvas>
                </div>
            </div>

            <!-- 2-3. Z_T5YIFR -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Z_T5YIFR (Inflation Exp)</div>
                        <div class="chart-subtitle">Inflation Driver</div>
                    </div>
                    <button class="info-btn" onclick="openModal('t5yifr')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartT5yifr"></canvas>
                </div>
            </div>

            <!-- 2-4. Z_Commodity -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Z_Commodity</div>
                        <div class="chart-subtitle">Inflation Driver</div>
                    </div>
                    <button class="info-btn" onclick="openModal('commodity')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartCommodity"></canvas>
                </div>
            </div>
        </div>

        <!-- ROW 3: Sentiment Components (0-100) -->
        <div class="section-title">Row 3: Sentiment Components (0 = Fear, 100 = Greed)</div>
        <div class="dashboard-row">
            <!-- 3-1. Momentum -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Momentum Score</div>
                        <div class="chart-subtitle">SPY vs 125MA</div>
                    </div>
                    <button class="info-btn" onclick="openModal('mom')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartSentMom"></canvas>
                </div>
            </div>

            <!-- 3-2. VIX -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Volatility Score (Inv)</div>
                        <div class="chart-subtitle">VIX Index</div>
                    </div>
                    <button class="info-btn" onclick="openModal('vix')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartSentVix"></canvas>
                </div>
            </div>

            <!-- 3-3. Put/Call -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Put/Call Score (Inv)</div>
                        <div class="chart-subtitle">Option Market Sentiment</div>
                    </div>
                    <button class="info-btn" onclick="openModal('pc')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartSentPC"></canvas>
                </div>
            </div>

            <!-- 3-4. Safe Haven -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Safe Haven Score</div>
                        <div class="chart-subtitle">Stock vs Bond Return</div>
                    </div>
                    <button class="info-btn" onclick="openModal('safe')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartSentSafe"></canvas>
                </div>
            </div>
        </div>

        <!-- ROW 4: More Components (Sentiment & Leading) -->
        <div class="section-title">Row 4: Sentiment (Junk) & Leading Components</div>
        <div class="dashboard-row">
            <!-- 4-1. Junk Spread -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Junk Bond Score (Inv)</div>
                        <div class="chart-subtitle">Credit Risk Appetite</div>
                    </div>
                    <button class="info-btn" onclick="openModal('junk')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartSentJunk"></canvas>
                </div>
            </div>

            <!-- 4-2. Copper/Gold -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Z_Copper/Gold</div>
                        <div class="chart-subtitle">Eco Recovery vs Fear</div>
                    </div>
                    <button class="info-btn" onclick="openModal('cg')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartLeadCG"></canvas>
                </div>
            </div>

            <!-- 4-3. Beta/Vol -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Z_Beta/Volatility</div>
                        <div class="chart-subtitle">Risk On vs Off</div>
                    </div>
                    <button class="info-btn" onclick="openModal('bv')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartLeadBV"></canvas>
                </div>
            </div>

            <!-- 4-4. Yield Spread -->
            <div class="chart-card">
                <div class="card-header">
                    <div>
                        <div class="chart-title">Z_Yield Spread (10Y-2Y)</div>
                        <div class="chart-subtitle">Recession Warning</div>
                    </div>
                    <button class="info-btn" onclick="openModal('ys')">?</button>
                </div>
                <div class="chart-area">
                    <canvas id="chartLeadYS"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Template -->
    <div id="infoModal" class="modal-overlay" onclick="if(event.target === this) closeModal()">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modalTitle" class="modal-title"></div>
            <div id="modalBody" class="modal-body"></div>
        </div>
    </div>

    <script>
        // --- Modal Content Database ---
        const MODAL_DATA = {
            macro: {
                title: "거시경제 국면 지수 (Macro Regime)",
                body: `
                    <p>경제 성장(Growth)과 물가(Inflation) 두 축을 기준으로 현재 경제 사계절을 진단합니다.</p>
                    <ul>
                        <li><strong>Reflation (회복):</strong> 성장↑ 물가↓ (주식 비중 확대)</li>
                        <li><strong>Overheat (과열):</strong> 성장↑ 물가↑ (원자재/가치주)</li>
                        <li><strong>Stagflation (스태그):</strong> 성장↓ 물가↑ (현금/금)</li>
                        <li><strong>Deflation (수축):</strong> 성장↓ 물가↓ (채권/달러)</li>
                    </ul>`
            },
            liquidity: {
                title: "글로벌 순유동성 지수 (Net Liquidity)",
                body: `
                    <p>연준(Fed)의 총자산에서 실제 시장에 풀리지 않은 자금을 뺀 '실질 유동성'입니다.</p>
                    <p><strong>공식:</strong> Fed Assets - TGA - RRP</p>
                    <ul>
                        <li>상승 시: 위험자산(주식, 코인) 선호 심리 강화</li>
                        <li>하락 시: 유동성 축소로 인한 조정 가능성</li>
                    </ul>`
            },
            sentiment: {
                title: "복합 심리 오실레이터 (Sentiment)",
                body: `<p>시장 참여자들의 공포와 탐욕을 측정합니다 (0~100).</p>
                       <ul>
                           <li><strong>0-20 (Extreme Fear):</strong> 공포. 역발상 매수 기회.</li>
                           <li><strong>80-100 (Extreme Greed):</strong> 탐욕. 매도/이익실현 고려.</li>
                           <li>구성: VIX, 풋/콜 비율, 하이일드 스프레드, 모멘텀, 안전자산 수요</li>
                       </ul>`
            },
            leading: {
                title: "시장 간 선행 지수 (Leading Indicator)",
                body: `<p>채권과 원자재 시장의 '스마트 머니' 흐름을 통해 주식 시장의 방향을 선행 예측합니다.</p>
                       <ul>
                           <li><strong>구리/금 비율:</strong> 경기 회복 vs 공포</li>
                           <li><strong>장단기 금리차:</strong> 경기 침체 경고 (역전 시)</li>
                           <li><strong>하이베타/저변동성:</strong> 내부 시장 에너지</li>
                       </ul>`
            },
            pmi: {
                title: "Z_PMI (ISM Manufacturing)",
                body: `<p>실물 경기의 대표적 선행 지수입니다. 신규 주문(New Orders)은 주가 사이클을 선행합니다.</p>`
            },
            ratio: {
                title: "Z_Ratio (Cyclical vs Defensive)",
                body: `<p>경기민감주와 방어주의 상대 성과입니다. 시장 참여자들이 전망하는 실시간 경제 성장을 반영합니다.</p>`
            },
            t5yifr: {
                title: "Z_T5YIFR (5Y Inflation Exp)",
                body: `<p>시장이 예상하는 5년 뒤의 기대 인플레이션입니다. 단기 유가 등 노이즈를 제거한 구조적 물가 뷰입니다.</p>`
            },
            commodity: {
                title: "Z_Commodity (Broad Index)",
                body: `<p>원자재(에너지, 금속, 농산물) 가격 지수입니다. 소비자물가(CPI)를 선행하는 물가 압력 지표입니다.</p>`
            },
            mom: { title: "Momentum Score", body: "<p>주가와 125일 이평선 이격도. 높을수록 탐욕.</p>" },
            vix: { title: "VIX Score", body: "<p>변동성 지수. 높을수록 공포(점수 낮음).</p>" },
            pc: { title: "Put/Call Score", body: "<p>풋옵션 거래량 비율. 높을수록 공포(점수 낮음).</p>" },
            safe: { title: "Safe Haven Score", body: "<p>주식 vs 채권 수익률 차이. 주식 우위 시 탐욕.</p>" },
            junk: { title: "Junk Bond Score", body: "<p>하이일드 스프레드. 스프레드 확대 시 공포(점수 낮음).</p>" },
            cg: { title: "Z_Copper/Gold", body: "<p>구리(경기) 대 금(공포) 비율. 상승 시 경기 회복 신호.</p>" },
            bv: { title: "Z_Beta/Volatility", body: "<p>공격적 주식 vs 안정적 주식 비율. 내부 시장 에너지.</p>" },
            ys: { title: "Z_Yield Spread", body: "<p>장단기 금리차(10Y-2Y). 역전 시 침체 경고.</p>" }
        };

        function openModal(key) {
            const data = MODAL_DATA[key];
            if(data) {
                document.getElementById('modalTitle').innerHTML = data.title;
                document.getElementById('modalBody').innerHTML = data.body;
                document.getElementById('infoModal').style.display = 'flex';
            }
        }

        function closeModal() {
            document.getElementById('infoModal').style.display = 'none';
        }

        // --- Chart Logic ---
        async function createCharts() {
            try {
                // Ensure the path is correct for your environment
                const response = await fetch('./data/market_indices.json');
                if (!response.ok) throw new Error("Network response was not ok");
                const text = await response.text();
                if (!text) return;

                const rawData = JSON.parse(text);
                const labels = rawData.map(d => d.date);
                
                // 1. Line Chart Options (Time Series)
                const lineOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { 
                            display: true, 
                            ticks: { maxTicksLimit: 6, font: { size: 10 } },
                            grid: { display: false }
                        },
                        y: { grid: { color: '#f0f0f0' } }
                    },
                    elements: { point: { radius: 0, hoverRadius: 4 } }
                };

                // 2. Macro Regime Options (Scatter, Fixed Scale)
                const scatterOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { 
                            min: -3, max: 3, 
                            grid: { color: (ctx) => ctx.tick.value === 0 ? '#333' : '#eee', lineWidth: (ctx) => ctx.tick.value === 0 ? 1.5 : 1 }
                        },
                        y: { 
                            min: -3, max: 3, 
                            grid: { color: (ctx) => ctx.tick.value === 0 ? '#333' : '#eee', lineWidth: (ctx) => ctx.tick.value === 0 ? 1.5 : 1 }
                        }
                    }
                };

                // 3. Sentiment Options (Fixed 0-100)
                const sentimentOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { display: true, ticks: { maxTicksLimit: 6, font: { size: 10 } }, grid: { display: false } },
                        y: { 
                            min: 0, max: 100,
                            grid: { color: '#f0f0f0' },
                            ticks: { stepSize: 20 }
                        }
                    },
                    elements: { point: { radius: 0, hoverRadius: 4 } }
                };

                // --- Chart 1: Macro Regime (Scatter) ---
                const trailLength = 60;
                const recentData = rawData.slice(-trailLength);
                const scatterData = recentData.map(d => ({ x: d.growth_index, y: d.inflation_index }));
                
                // NEW: Generate fading colors for the trail (Older = More transparent, Newer = More opaque)
                const trailColors = scatterData.slice(0, -1).map((_, i, arr) => {
                    const opacity = 0.1 + (0.9 * (i / arr.length)); // Alpha from 0.1 to 1.0
                    return `rgba(100, 110, 120, ${opacity})`; // Slate grey-ish color
                });

                new Chart(document.getElementById('chartMacro'), {
                    type: 'scatter',
                    data: {
                        datasets: [
                            {
                                label: 'Trail (60 Days)',
                                data: scatterData.slice(0, -1),
                                backgroundColor: trailColors, // Array of fading colors
                                borderColor: trailColors,     // Matching borders
                                pointRadius: 3,               // Slightly larger to see fade effect
                                pointHoverRadius: 5
                            },
                            {
                                label: 'Current',
                                data: [scatterData[scatterData.length - 1]],
                                backgroundColor: '#e74c3c',
                                borderColor: '#ffffff',
                                borderWidth: 2,
                                pointRadius: 7,
                                pointHoverRadius: 9
                            }
                        ]
                    },
                    options: scatterOptions
                });

                // --- Chart 2: Liquidity (Line) ---
                new Chart(document.getElementById('chartLiquidity'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{ 
                            data: rawData.map(d => d.liquidity_index), 
                            borderColor: '#af52de', borderWidth: 2, fill: false, tension: 0.3 
                        }]
                    },
                    options: lineOptions
                });

                // --- Chart 3: Sentiment (Line 0-100) ---
                new Chart(document.getElementById('chartSentiment'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { 
                                data: rawData.map(d => d.sentiment_index), 
                                borderColor: '#ff9500', borderWidth: 2, fill: false, tension: 0.3 
                            },
                            // Threshold Lines
                            {
                                data: Array(labels.length).fill(80),
                                borderColor: 'rgba(231, 76, 60, 0.3)', borderWidth: 1, borderDash: [5, 5], pointRadius: 0, fill: false
                            },
                            {
                                data: Array(labels.length).fill(20),
                                borderColor: 'rgba(46, 204, 113, 0.3)', borderWidth: 1, borderDash: [5, 5], pointRadius: 0, fill: false
                            }
                        ]
                    },
                    options: sentimentOptions
                });

                // --- Chart 4: Leading (Line) ---
                new Chart(document.getElementById('chartLeading'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{ 
                            data: rawData.map(d => d.leading_index), 
                            borderColor: '#34c759', borderWidth: 2, fill: false, tension: 0.3 
                        }]
                    },
                    options: lineOptions
                });

                // --- Helper for Single Line Chart ---
                const createComponentChart = (id, dataKey, color, options = lineOptions) => {
                    new Chart(document.getElementById(id), {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{ 
                                data: rawData.map(d => d[dataKey]), 
                                borderColor: color, borderWidth: 1.5, fill: false, tension: 0.1 
                            }]
                        },
                        options: options
                    });
                };

                // Row 2: Macro Components
                createComponentChart('chartPmi', 'z_pmi', '#007aff');
                createComponentChart('chartRatio', 'z_ratio', '#007aff');
                createComponentChart('chartT5yifr', 'z_t5yifr', '#ff3b30');
                createComponentChart('chartCommodity', 'z_commodity', '#ff3b30');

                // Row 3: Sentiment Components (0-100)
                createComponentChart('chartSentMom', 'score_momentum', '#ff9500', sentimentOptions);
                createComponentChart('chartSentVix', 'score_vix', '#ff9500', sentimentOptions);
                createComponentChart('chartSentPC', 'score_putcall', '#ff9500', sentimentOptions);
                createComponentChart('chartSentSafe', 'score_safehaven', '#ff9500', sentimentOptions);

                // Row 4: Sentiment (Junk) & Leading Components
                createComponentChart('chartSentJunk', 'score_junk', '#ff9500', sentimentOptions);
                createComponentChart('chartLeadCG', 'z_coppergold', '#34c759');
                createComponentChart('chartLeadBV', 'z_betavol', '#34c759');
                createComponentChart('chartLeadYS', 'z_yieldspread', '#34c759');

            } catch (error) {
                console.error("Error:", error);
            }
        }

        createCharts();
    </script>
</body>
</html>