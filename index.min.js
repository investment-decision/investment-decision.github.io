async function createCharts(){try{const e=await fetch('/data/market_indices.json');if(!e.ok)throw new Error('Network response was not ok');const t=await e.json();if(t.length>0){const e=t[t.length-1][0];document.getElementById('last-updated').textContent=`Last updated: ${e}`}const a=t.map(e=>e[0]),n={responsive:!0,maintainAspectRatio:!1,interaction:{mode:'index',intersect:!1},plugins:{legend:{display:!1}},scales:{x:{display:!0,ticks:{maxTicksLimit:6,font:{size:10},callback:function(e){const t=this.getLabelForValue(e);return t&&t.endsWith('-01')?t.substring(0,7):null}},grid:{display:!1}},y:{grid:{color:'#f0f0f0'}}},elements:{point:{radius:0,hoverRadius:4}}},i={responsive:!0,maintainAspectRatio:!1,interaction:{mode:'index',intersect:!1},plugins:{legend:{display:!1}},scales:{x:{display:!0,ticks:{maxTicksLimit:6,font:{size:10},callback:function(e){const t=this.getLabelForValue(e);return t&&t.endsWith('-01')?t.substring(0,7):null}},grid:{display:!1}},y:{min:0,max:100,grid:{color:'#f0f0f0'},ticks:{stepSize:20}}},elements:{point:{radius:0,hoverRadius:4}}},o=60,r=t.slice(-o),l=r.map(e=>({x:e[1],y:e[2],date:e[0]})),d=l.map(e=>Math.abs(e.x)),s=l.map(e=>Math.abs(e.y)),c=Math.max(...d,...s),u=Math.ceil(2*c)/2,h={responsive:!0,maintainAspectRatio:!1,interaction:{mode:'point',intersect:!0},plugins:{legend:{display:!1},tooltip:{filter:function(e,t){return 0===t},callbacks:{title:e=>{const t=e?.[0]?.raw;return t?.date??''},label:e=>{const{x:t,y:a}=e.raw||{};return`Growth: ${'number'==typeof t?t.toFixed(2):t}, Inflation: ${'number'==typeof a?a.toFixed(2):a}`}}}},scales:{x:{min:-u,max:u,grid:{color:e=>0===e.tick.value?'#333':'#eee',lineWidth:e=>0===e.tick.value?1.5:1}},y:{min:-u,max:u,grid:{color:e=>0===e.tick.value?'#333':'#eee',lineWidth:e=>0===e.tick.value?1.5:1}}}},m=l.slice(0,-1).map((e,t,a)=>`rgba(100, 110, 120, ${.1+t/a.length*.9})`),f=r[0][0],b=r[r.length-2][0],g={id:'quadrantLabels',afterDraw:e=>{const{ctx:t,chartArea:{left:a,right:n,top:i,bottom:o,width:r,height:l},scales:{x:d,y:s}}=e,c=d.getPixelForValue(0),u=s.getPixelForValue(0);t.save(),t.font='bold 12px Inter',t.fillStyle='rgba(150, 150, 150, 0.4)',t.textAlign='center',t.textBaseline='middle';const h=(c+n)/2,m=(i+u)/2,f=(a+c)/2,b=(i+u)/2,g=(a+c)/2,p=(u+o)/2,y=(c+n)/2,k=(u+o)/2;t.fillText('OVERHEAT',h,m),t.fillText('STAGFLATION',f,b),t.fillText('DEFLATION',g,p),t.fillText('REFLATION',y,k),t.restore()}};new Chart(document.getElementById('chartMacro'),{type:'scatter',data:{datasets:[{label:`${f} ~ ${b}`,data:l.slice(0,-1),backgroundColor:m,borderColor:m,pointRadius:3,pointHoverRadius:5},{label:'Current',data:[l[l.length-1]],backgroundColor:'#e74c3c',borderColor:'#ffffff',borderWidth:2,pointRadius:7,pointHoverRadius:9}]},options:h,plugins:[g]}),new Chart(document.getElementById('chartLiquidity'),{type:'line',data:{labels:a,datasets:[{data:t.map(e=>e[3]),borderColor:'#af52de',borderWidth:2,fill:!1,tension:.3}]},options:n}),new Chart(document.getElementById('chartSentiment'),{type:'line',data:{labels:a,datasets:[{data:t.map(e=>e[4]),borderColor:'#ff9500',borderWidth:2,fill:!1,tension:.3},{data:Array(a.length).fill(80),borderColor:'rgba(231, 76, 60, 0.3)',borderWidth:1,borderDash:[5,5],pointRadius:0,fill:!1},{data:Array(a.length).fill(20),borderColor:'rgba(46, 204, 113, 0.3)',borderWidth:1,borderDash:[5,5],pointRadius:0,fill:!1}]},options:i}),new Chart(document.getElementById('chartLeading'),{type:'line',data:{labels:a,datasets:[{data:t.map(e=>e[5]),borderColor:'#34c759',borderWidth:2,fill:!1,tension:.3}]},options:n});const p=(e,i,o,r=n)=>{new Chart(document.getElementById(e),{type:'line',data:{labels:a,datasets:[{data:t.map(e=>e[i]),borderColor:o,borderWidth:1.5,fill:!1,tension:.1}]},options:r})};p('chartPmi',6,'#007aff'),p('chartRatio',7,'#007aff'),p('chartT5yifr',8,'#ff3b30'),p('chartCommodity',9,'#ff3b30'),p('chartSentMom',11,'#ff9500',i),p('chartSentVix',12,'#ff9500',i),p('chartSentSafe',14,'#ff9500',i),p('chartSentJunk',15,'#ff9500',i),p('chartLeadCG',16,'#34c759'),p('chartLeadBV',17,'#34c759'),p('chartLeadYS',18,'#34c759')}catch(e){}}const navigateTo=e=>{history.pushState(null,null,e),handleLocation()},handleLocation=async()=>{let e=location.pathname;e.length>1&&e.endsWith('/')&&(e=e.slice(0,-1)),e=e.toLowerCase();let t='dashboard';'/about'===e&&(t='about'),'/references'===e&&(t='references');const a=document.getElementById('dashboard-page'),n=document.getElementById('about-page'),i=document.getElementById('references-page');a&&(a.style.display='dashboard'===t?'':'none'),n&&(n.style.display='about'===t?'':'none'),i&&(i.style.display='references'===t?'':'none');const o=document.getElementById('btn-dashboard'),r=document.getElementById('btn-about'),l=document.getElementById('btn-references');o&&o.classList.toggle('nav-btn-active','dashboard'===t),r&&r.classList.toggle('nav-btn-active','about'===t),l&&l.classList.toggle('nav-btn-active','references'===t);const d=document.querySelector('meta[name="description"]');'dashboard'===t&&(document.title='Market Owl | Wise Market Regime Analysis',d&&(d.content='Market Owl: Quantitative market regime dashboard visualizing Growth, Inflation, Liquidity, and Sentiment. See through the noise with data-driven insights.')),'about'===t&&(document.title='About MarketOwl.net',d&&(d.content='Learn about Market Owl\'s quantitative methodology: How we track Global Net Liquidity, identify Market Regimes (Reflation vs Stagflation), and forecast trends.')),'references'===t&&(document.title='References | MarketOwl.net',d&&(d.content='Trusted data sources and references used by Market Owl, including IMF, World Bank, FRED, and BIS data for macro-economic analysis.'))};window.addEventListener('popstate',handleLocation),document.addEventListener('DOMContentLoaded',()=>{document.body.addEventListener('click',e=>{e.target.matches('[data-link]')&&(e.preventDefault(),navigateTo(e.target.href))}),handleLocation(),createCharts()});
